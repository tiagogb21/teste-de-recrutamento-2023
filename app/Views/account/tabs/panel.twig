<div name="balance-area" class="col-md-12 mb-3">
	<div class="row">
		<div class="col-md-4">
			<div class="card p-0">
				<div class="card-header">
					Saldo Disponível
				</div>
				<div class="card-body">
					<h4 class="text-center mt-3">
						R$
						{{ balances.available }}
					</h4>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card p-0">
				<div class="card-header">
					Saldo Futuro
				</div>
				<div class="card-body">
					<h4 class="text-center mt-3">
						R$
						{{ balances.future }}
					</h4>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card p-0">
				<div class="card-header">
					Saldo Bloqueado
				</div>
				<div class="card-body">
					<h4 class="text-center mt-3">
						R$
						{{ balances.blocked }}
					</h4>
				</div>
			</div>
		</div>
	</div>
</div>
<div name="data-filter-form" class="col-md-12 mb-4">
	<div class="row">
		<div class="col-6">
			<label class="form-label">Data início</label>
			<input type="date" id="start_date" class="form-control">
		</div>
		<div class="col-6">
			<label class="form-label">Data fim</label>
			<input type="date" id="end_date" class="form-control">
		</div>
	</div>
</div>
<div name="historic-area" class="col-md-12">
	<div class="card p-0">
		<div class="card-header">
			Histórico
		</div>
		<div class="card-body">
			{% if histories %}
				{% for history in histories %}
					<div style="background-color: {{ history.history_type.color }};" name"card" class="col-md-12 p-2 mb-2 historic">
						<div class="row">
							<div class="col-md-4">
								<div>
									<b>{{ history.history_type.description }}</b>
								</div>
								<div>
									<label class="historic-money-label mb-1">R$
										{{ history.transaction.value }}</label>
								</div>
							</div>
							<div class="col-md-2">
								{% if history.transaction.product_id %}
									<div class="product-image-card">
										<img src="{{ history.transaction.product.image }}" class="img-thumbnail" alt="...">
									</div>
								{% endif %}
							</div>
							<div class="col-md-6">
								<div class="row">
									<div class="col-md-9">
										{% if history.note %}
											<div>
												<b>Motivo:</b>
											</div>
											<div>
												<p>{{ history.note }}</p>
											</div>
										{% endif %}
									</div>
									<div class="col-md-3">{{ history.date_added }}</div>
								</div>
							</div>
						</div>
					</div>
				{% endfor %}
			{% else %}
				<div class="text-center">
					Não há registros de histórico ainda!
				</div>
			{% endif %}
		</div>
	</div>
</div>

<script>
	const startDate = document.getElementById("start_date");
	const endDate = document.getElementById("end_date");

	const formatedDate = (date) => {
		const yyyy = date.getFullYear().toString().padStart(4, '0');
		const mm = (date.getMonth() + 1).toString().padStart(2, '0');
		const dd = date.getDate().toString().padStart(2, '0');
		return `${yyyy}-${mm}-${dd}`;
	}

	const today = new Date();
	const nextMonth = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);

	startDate.value = formatedDate(today);
	endDate.value = formatedDate(nextMonth);

	startDate.addEventListener('change', (e) => {
		startDate.value = e.target.value;
		sendDataToBack();
	});

	endDate.addEventListener('change', (e) => {
		endDate.value = e.target.value;
		sendDataToBack();
	});

	const sendDataToBack = () => {
		const storeData = {
			start_date: startDate.value,
			end_date: endDate.value
		};

		return fetch('/account/seller/verifydate', {
			method: 'POST',
			body: JSON.stringify(storeData),
			headers: {
				'Content-Type': 'application/json',
			}
		})
		.then(response => {
			if (response.ok) {
				return response.json();
			} else {
				throw new Error('Network response was not ok');
			}
		})
		.then(data => console.log(data))
		.catch(error => console.error(error));
	}

	sendDataToBack();
</script>
